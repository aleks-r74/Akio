import{a as A,b as H,c as z,e as J,f as G}from"./chunk-7VINSVV7.js";import{h as O}from"./chunk-AV3SZMJO.js";import"./chunk-IMEDXYCP.js";import{Ca as j,Ha as f,Ja as v,Ka as S,Ma as g,Na as F,Pa as M,Qa as R,Ra as a,Sa as s,Sb as U,Ta as b,W as T,Wa as x,Xa as _,Ya as p,a as V,b as B,cc as E,da as $,dc as k,ea as C,ec as N,fa as h,fb as l,gb as m,gc as q,hb as w,kb as P,ma as y,pb as d,qb as u,rb as L,ua as o,va as I}from"./chunk-KMNQFCXU.js";function Z(t,c){if(t&1){let e=x();a(0,"app-pagination",10),_("pageSelected",function(n){C(e);let r=p();return h(r.onPageNumClick(n))}),s()}if(t&2){let e=p();v("currentPage",e.currentPage)("totalPages",e.totalPages)}}function ee(t,c){if(t&1){let e=x();a(0,"button",17),_("click",function(){let n=C(e).$implicit,r=p(2).$implicit,D=p();return h(D.onEmployeeSelected(r,n))}),l(1),s()}if(t&2){let e=c.$implicit,i=p(2).$implicit;S("is-info",i.employee===e),o(),m(e)}}function te(t,c){if(t&1&&M(0,ee,2,3,"button",16,F),t&2){let e=p(2);R(e.employeeList)}}function ne(t,c){if(t&1&&(a(0,"button",15),l(1),d(2,"translate"),s()),t&2){let e=p().$implicit;o(),w(" ",e.employee?e.employee:u(2,1,"Not assigned")," ")}}function ie(t,c){if(t&1){let e=x();a(0,"tr")(1,"td",11),l(2),d(3,"date"),s(),a(4,"td",11),l(5),s(),a(6,"td",11),l(7),s(),a(8,"td",12),_("click",function(){let n=C(e).$implicit,r=p();return h(r.onTransactionClick(n))}),a(9,"div"),l(10),d(11,"transactionServicesPipe"),s()(),a(12,"td",13)(13,"div",14),f(14,te,2,0)(15,ne,3,3,"button",15),s()()()}if(t&2){let e=c.$implicit,i=p();o(2),m(L(3,5,e.date_time,"MMM dd HH:mm")),o(3),m(e.receipt_num),o(2),m(e.money_accepted),o(3),m(u(11,8,e.services)),o(4),g((e.employee===""||!e.readonly)&&i.authService.getAccessLevel()>1?14:15)}}function ae(t,c){if(t&1&&b(0,"app-page-summary",8),t&2){let e=p();v("pageSum",e.httpResponse.pageSum)("transactionNum",e.httpResponse.count)("transactionSum",e.httpResponse.sum)}}var W=(()=>{class t{authService;transactionUpd=new y;pageSelected=new y;httpResponse;employeeList;totalPages;currentPage;transactionDetails;showDetails=!1;constructor(e){this.authService=e}ngOnChanges(e){e.httpResponse&&(this.totalPages=this.httpResponse?.totalPages,this.currentPage=this.httpResponse?.currentPage,this.currentPage=this.currentPage?this.currentPage+1:1)}onPageNumClick(e){this.pageSelected.emit(e)}onTransactionClick(e){this.transactionDetails=e,this.showDetails=!0}onEmployeeSelected(e,i){e.employee=i,this.transactionUpd.emit()}static \u0275fac=function(i){return new(i||t)(I(O))};static \u0275cmp=T({type:t,selectors:[["app-transactions-table"]],inputs:{httpResponse:"httpResponse",employeeList:"employeeList"},outputs:{transactionUpd:"transactionUpd",pageSelected:"pageSelected"},standalone:!0,features:[$,P],decls:29,vars:19,consts:[[1,"container","is-max-tablet"],[1,"is-flex","is-justify-content-center"],[1,"table","is-hoverable","is-striped","is-narrow-mobile","has-text-centered","is-size-7-mobile","is-size-6","my-2"],["colspan","5",1,"m-0","p-0"],[1,"is-flex","is-justify-content-center","mb-1"],[3,"currentPage","totalPages"],[1,"has-background-danger-95"],[1,"has-text-centered"],[3,"pageSum","transactionNum","transactionSum"],[3,"close","active","transaction"],[3,"pageSelected","currentPage","totalPages"],[1,"has-text-centered","is-vcentered"],[1,"has-text-left",3,"click"],[1,"p-1","is-vcentered"],[1,"tags","is-centered"],[1,"tag","is-info"],[1,"tag","is-hoverable",3,"is-info"],[1,"tag","is-hoverable",3,"click"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"div",1)(2,"table",2)(3,"thead")(4,"tr")(5,"td",3)(6,"div",4),f(7,Z,1,2,"app-pagination",5),s()()(),a(8,"tr",6)(9,"th",7),l(10),d(11,"translate"),s(),a(12,"th",7),l(13),d(14,"translate"),s(),a(15,"th",7),l(16),d(17,"translate"),s(),a(18,"th",7),l(19),d(20,"translate"),s(),a(21,"th",7),l(22),d(23,"translate"),s()()(),a(24,"tbody"),M(25,ie,16,10,"tr",null,F),s()()()(),f(27,ae,1,3,"app-page-summary",8),a(28,"app-transaction-details",9),_("close",function(){return n.showDetails=!1}),s()),i&2&&(o(7),g(n.currentPage&&n.totalPages?7:-1),o(3),m(u(11,9,"Time")),o(3),m(u(14,11,"Receipt")),o(3),m(u(17,13,"Paid")),o(3),m(u(20,15,"Services")),o(3),m(u(23,17,"Employee")),o(3),R(n.httpResponse==null?null:n.httpResponse.transactionsOnThePage),o(2),g(n.httpResponse?27:-1),o(),v("active",n.showDetails)("transaction",n.transactionDetails))},dependencies:[A,J,z,U,H,k,E],styles:[".date-time[_ngcontent-%COMP%]{min-width:90px}.services[_ngcontent-%COMP%]{min-width:250px}.employee[_ngcontent-%COMP%]{min-width:100px}"]})}return t})();function oe(t,c){if(t&1&&(a(0,"div",2)(1,"span",5)(2,"span",6),l(3),s(),a(4,"span",7),l(5),s()()()),t&2){let e=c.$implicit,i=c.$index;o(),S("mt-responsive",i!==0),o(2),w("",e.name,":"),o(2),m(e.sum)}}var X=(()=>{class t{employeeCalcs;saveClick=new y;resetClick=new y;onSaveClick(){this.saveClick.emit()}onResetClick(){this.resetClick.emit()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=T({type:t,selectors:[["app-employee-total"]],inputs:{employeeCalcs:"employeeCalcs"},outputs:{saveClick:"saveClick",resetClick:"resetClick"},standalone:!0,features:[P],decls:12,vars:6,consts:[[1,"pagination-height","is-hidden-touch"],[1,"container","is-flex-touch","is-justify-content-center","is-align-items-center"],[1,"is-flex","is-justify-content-center"],[1,"button","tag","is-hoverable","is-danger","my-2","mx-1",2,"width","100px",3,"click"],[1,"button","tag","is-hoverable","is-primary","my-2","mx-1",2,"width","100px",3,"click"],[1,"tags","has-addons","is-centered"],[1,"tag","is-info","fixed-width-tag"],[1,"tag","is-white","has-text-weight-semibold","fixed-width-tag"]],template:function(i,n){i&1&&(b(0,"div",0),a(1,"div",1),M(2,oe,6,4,"div",2,F),a(4,"div")(5,"button",3),_("click",function(){return n.onResetClick()}),l(6),d(7,"translate"),s()(),a(8,"div")(9,"button",4),_("click",function(){return n.onSaveClick()}),l(10),d(11,"translate"),s()()()),i&2&&(o(2),R(n.employeeCalcs),o(4),m(u(7,2,"Reset")),o(4),m(u(11,4,"Save")))},dependencies:[k,E],styles:[".fixed-width-tag[_ngcontent-%COMP%]{min-width:50px;white-space:nowrap}.pagination-height[_ngcontent-%COMP%]{height:42px}@media (min-width: 1024px){.mt-responsive[_ngcontent-%COMP%]{margin-top:1rem}}"]})}return t})();function se(t,c){t&1&&(a(0,"p"),l(1),d(2,"translate"),s()),t&2&&(o(),w("",u(2,1,"Loading")," ..."))}function re(t,c){if(t&1&&b(0,"app-error",1),t&2){let e=p();v("error",e.errors())}}function le(t,c){if(t&1){let e=x();a(0,"div",7)(1,"app-employee-total",8),_("saveClick",function(){C(e);let n=p(2);return h(n.saveTransactions())})("resetClick",function(){C(e);let n=p(2);return h(n.onResetClick())}),s()()}if(t&2){let e=p(2);o(),v("employeeCalcs",e.emloyeeCalcs)}}function pe(t,c){if(t&1){let e=x();a(0,"div",5)(1,"app-transactions-table",6),_("transactionUpd",function(){C(e);let n=p();return h(n.onEmployeeSet())})("pageSelected",function(n){C(e);let r=p();return h(r.onPageSelected(n))}),s()(),f(2,le,2,1,"div",7)}if(t&2){let e=p();o(),v("httpResponse",e.response)("employeeList",e.employees),o(),g(e.authService.getAccessLevel()>1?2:-1)}}function ce(t,c){t&1&&(a(0,"div",0)(1,"p"),l(2,"No data for this period"),s()())}var je=(()=>{class t{httpService;authService;fromDateTime;toDateTime;employees;emloyeeCalcs;savedCalcs;response;dates;errors=j(void 0);requestFlag=!1;constructor(e,i){this.httpService=e,this.authService=i;let n=new Date,r=new Date;n.setUTCHours(0),n.setMinutes(0),n.setSeconds(0),r.setUTCHours(23),r.setMinutes(59),r.setSeconds(0),this.toDateTime=r.toISOString().substring(0,19),this.fromDateTime=n.toISOString().substring(0,19)}calculateEmployeeTransactions(){if(!this.employees)return;let e=[];for(let i of this.employees){let n=this.response?.transactionsOnThePage.filter(r=>r.employee===i&&!r.readonly).map(r=>r.money_accepted).reduce((r,D)=>r+D,0);n=n||0,this.savedCalcs?.has(i)&&(n+=this.savedCalcs?.get(i)),e.push({name:i,sum:n})}this.emloyeeCalcs=e}onEmployeeSet(){this.calculateEmployeeTransactions()}onResetClick(){this.response?.transactionsOnThePage.forEach(e=>{e.readonly||(e.employee="")}),this.calculateEmployeeTransactions()}onDatesSelected(e){this.dates=e,this.loadData(1)}onPageSelected(e){this.loadData(e)}loadData(e){this.requestFlag=!0,this.httpService.getTransactions(this.dates,e-1).subscribe({next:i=>{this.response=B(V({},i),{transactionsOnThePage:i.transactionsOnThePage.map(n=>(n.employee&&(n.readonly=!0),n))}),this.savedCalcs=new Map(Object.entries(i.employeesSum)),this.employees=Array.from(this.savedCalcs.keys())},error:i=>this.errors.set(i),complete:()=>{this.requestFlag=!1,this.onResetClick()}})}saveTransactions(){this.requestFlag=!0,this.response&&this.httpService.updateTransactionsEmployees(this.response.transactionsOnThePage).subscribe({error:e=>{this.errors.set(e)},complete:()=>{this.loadData(this.response.currentPage+1)}})}static \u0275fac=function(i){return new(i||t)(I(q),I(O))};static \u0275cmp=T({type:t,selectors:[["app-transactions"]],standalone:!0,features:[P],decls:8,vars:4,consts:[[1,"is-flex","is-justify-content-center","mt-1"],[3,"error"],[3,"dates"],[1,"container","is-max-mobile"],[1,"columns","is-desktop","is-centered"],[1,"column","is-narrow","is-offset-1-desktop"],[3,"transactionUpd","pageSelected","httpResponse","employeeList"],[1,"column","is-narrow"],[3,"saveClick","resetClick","employeeCalcs"]],template:function(i,n){i&1&&(a(0,"div",0),f(1,se,3,3,"p")(2,re,1,1,"app-error",1),s(),a(3,"app-date-between",2),_("dates",function(D){return n.onDatesSelected(D)}),s(),a(4,"div",3)(5,"div",4),f(6,pe,3,3)(7,ce,3,0,"div",0),s()()),i&2&&(S("is-invisible",!n.requestFlag),o(),g(n.errors()?2:1),o(5),g(n.response!=null&&n.response.count&&(n.response!=null&&n.response.count)?6:7))},dependencies:[W,X,G,N,k,E]})}return t})();export{je as TransactionsComponent};
