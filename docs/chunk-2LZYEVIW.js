import{c as ne,d as ie,e as oe}from"./chunk-T6UMYVFG.js";import{a as ge,b as ye,c as $}from"./chunk-T44VF276.js";import{h as te}from"./chunk-QGIE6CRT.js";import{a as X}from"./chunk-L4HLJOSY.js";import{b as re,c as k,d as ae,e as se,f as A,g as I,h as le,i as me,k as ce,l as pe,n as de,s as ue,t as fe,v as he}from"./chunk-42ZB74LF.js";import{$a as G,Ha as x,Ja as m,Ka as L,Ma as w,Na as T,Pa as b,Qa as D,Ra as r,Rb as V,Sa as a,Sb as O,Ta as _,Tb as W,Ua as Y,Va as H,W as y,Wa as F,Xa as f,Ya as h,a as N,b as R,da as B,dc as E,ea as v,ec as P,fa as S,fb as s,fc as Z,gb as g,hb as q,hc as ee,ib as J,lb as C,ma as M,ob as K,pb as Q,qb as c,rb as p,sb as U,ua as o,va as j}from"./chunk-EB4YEUVP.js";function Fe(n,d){if(n&1){let e=F();r(0,"div",0)(1,"div",1)(2,"form",2),f("ngSubmit",function(){v(e);let i=h();return S(i.onSubmit())}),r(3,"div",3),Y(4,4),r(5,"p",5),_(6,"app-select",6),a(),r(7,"p",5),_(8,"app-select",7),a(),H(),r(9,"p",5),_(10,"input",8),c(11,"translate"),a(),r(12,"p",5),_(13,"input",9),c(14,"translate"),a(),r(15,"p",5)(16,"button",10),s(17),c(18,"translate"),a()()()()()()}if(n&2){let e=h();o(2),m("formGroup",e.transferForm),o(4),m("control",e.sourceControl)("options",e.containerNames),o(2),m("control",e.destControl)("options",e.containerNames),o(2),G("placeholder",p(11,9,"Amount")),o(3),G("placeholder",p(14,11,"Description")),o(3),m("disabled",!e.transferForm.valid),o(),q(" ",p(18,13,"Transfer")," ")}}var Ce=(()=>{class n{containerNames;moneyFlowEvent=new M;transferForm=new A({direction:new A({source:new I("From",k.required),dest:new I("To",k.required)},ge),amount:new I("",[k.required,k.min(1)]),descr:new I("",k.required)});get sourceControl(){return this.transferForm.controls.direction.controls.source}get destControl(){return this.transferForm.controls.direction.controls.dest}onSubmit(){let e=this.transferForm.controls.direction.get("source").value,t=this.transferForm.controls.direction.get("dest").value;e=$(this.containerNames,e),t=$(this.containerNames,t);let i={source:e,dest:t,amount:parseFloat(this.transferForm.controls.amount.value),description:this.transferForm.controls.descr.value};this.transferForm.controls.amount.setValue(""),this.transferForm.controls.descr.setValue(""),this.moneyFlowEvent.emit(i)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=y({type:n,selectors:[["app-transfer-form"]],inputs:{containerNames:"containerNames"},outputs:{moneyFlowEvent:"moneyFlowEvent"},standalone:!0,features:[C],decls:1,vars:1,consts:[[1,"container","is-max-tablet"],[1,"m-1","is-flex","is-justify-content-center"],[3,"ngSubmit","formGroup"],[1,"field","has-addons"],["formGroupName","direction"],[1,"control"],["firstOption","From",3,"control","options"],["firstOption","To",3,"control","options"],["type","number","min","0.5","formControlName","amount",1,"input","is-size-7-touch",3,"placeholder"],["type","text","formControlName","descr","maxlength","100",1,"input","is-size-7-touch",3,"placeholder"],["type","submit",1,"button","is-info","is-size-7-touch",3,"disabled"]],template:function(t,i){t&1&&x(0,Fe,19,15,"div",0),t&2&&w(i.containerNames?0:-1)},dependencies:[he,le,re,me,ae,se,fe,ue,ce,de,pe,ye,P,E]})}return n})();var xe=(n,d)=>({"has-background-success-95":n,"has-background-success-75":d});function Me(n,d){if(n&1){let e=F();r(0,"button")(1,"span",2),_(2,"i",3)(3,"i",4),a(),r(4,"table",5),f("click",function(){let i=v(e).$implicit,l=h(2);return S(l.onContainerClick(i))}),r(5,"tr")(6,"td",6),s(7),a()(),r(8,"tr")(9,"td"),s(10),a()()()()}if(n&2){let e=d.$implicit,t=h(2);o(2),L("is-invisible",!t.checkInFlow(e.containerName)),o(),L("is-invisible",!t.checkOutFlow(e.containerName)),o(),m("ngClass",K(7,xe,e!=t.selected,e==t.selected)),o(3),g(e.containerName),o(3),g(e.balance)}}function Te(n,d){if(n&1&&(r(0,"div",0)(1,"div",1),b(2,Me,11,10,"button",null,T),a()()),n&2){let e=h();o(2),D(e.containers)}}var ve=(()=>{class n{containers;summaryMfs;clickEvent=new M;templateBgColor="has-background-success-95";selectedBgColor="has-background-success-75";selected;outFlow=[];inFlow=[];ngOnChanges(e){if(!this.summaryMfs)return;let t=new Date;this.inFlow=[],this.outFlow=[];for(let i of this.summaryMfs){let l=new Date(i.time_stamp),u=l.getDate()===t.getDate()&&l.getMonth()===t.getMonth()&&l.getFullYear()===t.getFullYear();u&&this.inFlow?.push(i.dest),u&&this.outFlow?.push(i.source)}}checkInFlow(e){for(let t of this.inFlow)if(t===e)return!0;return!1}checkOutFlow(e){for(let t of this.outFlow)if(t===e)return!0;return!1}onContainerClick(e){this.selected=e,this.clickEvent.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=y({type:n,selectors:[["app-containers"]],inputs:{containers:"containers",summaryMfs:"summaryMfs"},outputs:{clickEvent:"containerClick"},standalone:!0,features:[B,C],decls:1,vars:1,consts:[[1,"is-flex","is-justify-content-center"],[1,"field","is-grouped","is-grouped-multiline","is-justify-content-center"],[1,"icon"],[1,"fa-solid","fa-angles-down","mx-1"],[1,"fa-solid","fa-angles-up","mx-1"],[1,"has-background-success-95","fixed-width-tag","has-text-centered","is-size-6",3,"click","ngClass"],[1,"is-capitalized","has-text-weight-bold"]],template:function(t,i){t&1&&x(0,Te,4,0,"div",0),t&2&&w(i.containers?0:-1)},dependencies:[V],styles:[".fixed-width-tag[_ngcontent-%COMP%]{min-width:90px;white-space:nowrap;border-radius:10px}"]})}return n})();var be=(n,d,e)=>({"has-background-info-65":n,"has-background-info-35":d,highlighted:e});function De(n,d){if(n&1){let e=F();r(0,"button",4),f("click",function(){let i=v(e).$implicit,l=h();return S(l.onDirectionSelected(i))}),s(1),c(2,"titlecase"),c(3,"titlecase"),a()}if(n&2){let e=d.$implicit,t=h();m("ngClass",Q(7,be,e!=t.selected,e==t.selected,t.isFreshDirection(e))),o(),J("",p(2,3,e.source)," -> ",p(3,5,e.dest),"")}}var Se=(()=>{class n{directions;summaryMfs;directionSelected=new M;selected;fresh=[];ngOnChanges(e){if(e.directions&&this.directions?.length==1&&setTimeout(()=>this.onDirectionSelected(this.directions[0]),0),!e.summaryMfs||!this.summaryMfs)return;let t=new Date;for(let i of this.summaryMfs){let l=new Date(i.time_stamp);l.getDate()===t.getDate()&&l.getMonth()===t.getMonth()&&l.getFullYear()===t.getFullYear()&&this.fresh.push({source:i.source,dest:i.dest})}}onDirectionSelected(e){this.selected=e,this.directionSelected.emit(e)}isFreshDirection(e){return this.fresh.some(t=>t.source===e.source&&t.dest===e.dest)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=y({type:n,selectors:[["app-money-direction"]],inputs:{directions:"directions",summaryMfs:"summaryMfs"},outputs:{directionSelected:"directionSelected"},standalone:!0,features:[B,C],decls:5,vars:0,consts:[[1,"container","is-max-tablet","has-text-centered","mt-2"],[1,"fixed-grid","has-4-cols"],[1,"cell"],[1,"button","tag","is-hoverable","has-text-white","m-1","is-size-6","is-size-7-mobile",3,"ngClass"],[1,"button","tag","is-hoverable","has-text-white","m-1","is-size-6","is-size-7-mobile",3,"click","ngClass"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),b(3,De,4,11,"button",3,T),a()()()),t&2&&(o(3),D(i.directions))},dependencies:[V,O],styles:["div[_ngcontent-%COMP%]{min-height:35px}span[_ngcontent-%COMP%]{min-width:90px}.highlighted[_ngcontent-%COMP%]{border-color:#96dfbe;border-bottom-width:5px}"]})}return n})();function Ee(n,d){if(n&1&&(r(0,"tr")(1,"td"),s(2),c(3,"date"),a(),r(4,"td"),s(5),c(6,"titlecase"),a(),r(7,"td"),s(8),c(9,"titlecase"),a(),r(10,"td"),s(11),a()()),n&2){let e=d.$implicit;o(2),g(U(3,4,e.time_stamp,"MMMM d, HH:mm")),o(3),g(p(6,7,e.source)),o(3),g(p(9,9,e.dest)),o(3),g(e.amount)}}var we=(()=>{class n{summary;static \u0275fac=function(t){return new(t||n)};static \u0275cmp=y({type:n,selectors:[["app-flow-summary"]],inputs:{summary:"summary"},standalone:!0,features:[C],decls:18,vars:12,consts:[[1,"table","is-size-7","has-text-centered"],[1,"has-text-centered","min-width"]],template:function(t,i){t&1&&(r(0,"table",0)(1,"thead")(2,"tr")(3,"th",1),s(4),c(5,"translate"),a(),r(6,"th",1),s(7),c(8,"translate"),a(),r(9,"th",1),s(10),c(11,"translate"),a(),r(12,"th",1),s(13),c(14,"translate"),a()()(),r(15,"tbody"),b(16,Ee,12,11,"tr",null,T),a()()),t&2&&(o(4),g(p(5,4,"Last transaction")),o(3),g(p(8,6,"Source")),o(3),g(p(11,8,"Dest")),o(3),g(p(14,10,"Total")),o(3),D(i.summary))},dependencies:[P,E,O,W]})}return n})();function Pe(n,d){if(n&1&&_(0,"app-error",2),n&2){let e=h();m("error",e.errorResponse)}}function ke(n,d){n&1&&(r(0,"p",3),s(1,"Money transferred"),a())}function Ie(n,d){n&1&&(r(0,"p",3),s(1),c(2,"translate"),a()),n&2&&(o(),q("",p(2,1,"Loading"),"..."))}function Ne(n,d){if(n&1){let e=F();r(0,"div",13)(1,"button",14),f("click",function(){v(e);let i=h();return S(i.showLastTransactions=!0)}),s(2),c(3,"translate"),a()(),r(4,"app-modal",15),f("close",function(){v(e);let i=h();return S(i.showLastTransactions=!1)}),_(5,"app-flow-summary",16),a()}if(n&2){let e=h();o(2),g(p(3,3,"Month overview")),o(2),m("active",e.showLastTransactions),o(),m("summary",e.summaryMfs)}}var Ft=(()=>{class n{httpService;authService;containers;containerNames;summaryMfs;selectedConatiner;moneyFlowResponseDto;dates;totalPages;currentPage=1;transactionDetails;showDetails=!1;showLastTransactions=!1;moneyFlowRequest={from:void 0,to:void 0,source:void 0,dest:void 0,page:this.currentPage-1};errorResponse;requestFlag=!1;moneyTransferredFlag=!1;constructor(e,t){this.httpService=e,this.authService=t}ngOnInit(){this.requestFlag=!0,this.httpService.getContainers().subscribe({next:e=>{this.containers=e.containers,this.containerNames=this.containers.map(t=>t.containerName),this.summaryMfs=e.lastTransactions.reverse()},error:e=>{this.errorResponse=e},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}})}onMoneyTransfer(e){this.requestFlag=!0,this.moneyTransferredFlag=!1,this.httpService.transferMoney(e).subscribe({next:t=>{this.containers=t},error:t=>{this.errorResponse=t},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.moneyTransferredFlag=!0,this.ngOnInit()}})}onDatesSelected(e){this.moneyFlowRequest=R(N({},this.moneyFlowRequest),{from:e.from,to:e.to,page:this.currentPage-1}),this.loadMoneyFlows()}onContainerClick(e){this.selectedConatiner=e}onPageSelected(e){this.moneyFlowRequest=R(N({},this.moneyFlowRequest),{page:e-1}),this.currentPage=e,this.loadMoneyFlows()}onDirectionSelected(e){this.currentPage=1,this.moneyFlowRequest=R(N({},this.moneyFlowRequest),{source:e.source,dest:e.dest,page:this.currentPage-1}),this.loadMoneyFlows()}loadMoneyFlows(){Object.values(this.moneyFlowRequest).some(e=>e==null)||(this.moneyTransferredFlag=!1,this.requestFlag=!0,this.httpService.getMoneyFlows(this.moneyFlowRequest).subscribe({next:e=>{this.moneyFlowResponseDto=e,this.totalPages=e.totalPages},error:e=>{this.errorResponse=e},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}}))}loadTransactionByTimestamp(e){this.requestFlag=!0,this.moneyTransferredFlag=!1,this.httpService.getTransactions({from:e,to:e},0).subscribe({next:t=>{this.transactionDetails=t.transactionsOnThePage[0],this.showDetails=!0},error:t=>{this.errorResponse=t},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}})}static \u0275fac=function(t){return new(t||n)(j(ee),j(te))};static \u0275cmp=y({type:n,selectors:[["app-money-management"]],standalone:!0,features:[C],decls:15,vars:13,consts:[[1,"container","is-max-tablet"],[1,"is-flex","is-justify-content-center","mt-1",2,"min-height","35px"],[3,"error"],[1,"is-size-7"],[3,"moneyFlowEvent","containerNames"],[3,"containerClick","containers","summaryMfs"],[3,"directionSelected","directions","summaryMfs"],[3,"dates"],[1,"container"],[1,"columns","is-centered"],[1,"column","is-flex","is-justify-content-center","p-0","m-0"],[3,"receiptSelected","pageSelected","data","showDetails"],[3,"close","active","transaction"],[1,"field","is-grouped","is-grouped-multiline","is-justify-content-center"],[1,"button","is-size-7-touch","is-size-6","tag","mt-2",3,"click"],[3,"close","active"],[3,"summary"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1),x(2,Pe,1,1,"app-error",2)(3,ke,2,0,"p",3)(4,Ie,3,3,"p",3),a(),r(5,"app-transfer-form",4),f("moneyFlowEvent",function(u){return i.onMoneyTransfer(u)}),a(),x(6,Ne,6,5),r(7,"app-containers",5),f("containerClick",function(u){return i.onContainerClick(u)}),a(),r(8,"app-money-direction",6),f("directionSelected",function(u){return i.onDirectionSelected(u)}),a(),r(9,"app-date-between",7),f("dates",function(u){return i.onDatesSelected(u)}),a(),r(10,"div",8)(11,"div",9)(12,"div",10)(13,"app-money-flow-table",11),f("receiptSelected",function(u){return i.loadTransactionByTimestamp(u)})("pageSelected",function(u){return i.onPageSelected(u)}),a()()()(),r(14,"app-transaction-details",12),f("close",function(){return i.showDetails=!1}),a()()),t&2&&(o(2),w(i.errorResponse?2:-1),o(),w(i.moneyTransferredFlag&&!i.requestFlag?3:-1),o(),w(i.requestFlag&&!i.errorResponse?4:-1),o(),m("containerNames",i.containerNames),o(),w(i.authService.getAccessLevel()>1?6:-1),o(),m("containers",i.containers)("summaryMfs",i.summaryMfs),o(),m("directions",i.selectedConatiner==null?null:i.selectedConatiner.directions)("summaryMfs",i.summaryMfs),o(5),m("data",i.moneyFlowResponseDto)("showDetails",!0),o(),m("active",i.showDetails)("transaction",i.transactionDetails))},dependencies:[Ce,ve,oe,ne,Z,Se,ie,P,E,we,X]})}return n})();export{Ft as MoneyManagementComponent};
