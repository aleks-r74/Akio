import{a as W,b as Y,c as y,d as E}from"./chunk-FCYK4M3J.js";import{b as N,c as $,d as j,e as B,f as v,g as l,h as O,i as z,j as L,k as P,m as H,r as X,s as J,t as K,u as Q,v as U}from"./chunk-O5MWHH46.js";import{Ha as C,Ja as p,Ma as _,Na as A,Pa as V,Qa as G,Ra as i,Sa as s,Ta as a,W as S,Wa as T,Xa as x,Ya as u,bc as q,cc as D,dc as I,ea as w,ec as M,fa as b,fb as m,gb as g,hb as R,kb as k,ob as f,pb as h,ua as r,va as F}from"./chunk-EFT7P6D7.js";function oe(o,d){if(o&1&&a(0,"app-error",11),o&2){let e=u(2);p("error",e.errorResponse)}}function re(o,d){o&1&&(i(0,"p"),m(1),f(2,"translate"),s()),o&2&&(r(),R("",h(2,1,"Loading"),"..."))}function ie(o,d){if(o&1&&C(0,oe,1,1,"app-error",11)(1,re,3,3,"p"),o&2){let e=u();_(e.errorResponse?0:1)}}function se(o,d){if(o&1){let e=T();i(0,"div",10)(1,"p",3),a(2,"app-select",12),s(),i(3,"p",3),a(4,"app-select",13),s(),i(5,"p",3),a(6,"input",14),s(),i(7,"p",3),a(8,"input",15),s(),i(9,"p",3),a(10,"input",16),s(),i(11,"p",3),a(12,"input",17),s(),i(13,"p",3)(14,"button",18),x("click",function(){let n=w(e).$index,c=u();return b(c.onDelete(n))}),m(15," X "),s()()()}if(o&2){let e=d.$implicit,t=d.$index,n=u();p("id",t),r(2),p("options",n.options)("control",n.getControl(e,"source")),r(2),p("options",n.options)("control",n.getControl(e,"dest")),r(2),p("formControl",n.getControl(e,"amount")),r(2),p("formControl",n.getControl(e,"due_day")),r(2),p("formControl",n.getControl(e,"percent")),r(2),p("formControl",n.getControl(e,"descr"))}}var ve=(()=>{class o{httpService;errorResponse;requestFlag=!1;options=[];expenses=[];constructor(e){this.httpService=e}ngOnInit(){this.requestFlag=!0,this.httpService.getContainers().subscribe({next:e=>{this.options=e.containers.map(t=>t.containerName)},error:e=>this.errorResponse=e,complete:()=>{this.errorResponse=void 0,this.loadExpenses()}})}formGroup=new v({expenses:new Q([])});get expensesArray(){return this.formGroup.controls.expenses}getControl(e,t){return e.controls[t]instanceof l?e.controls[t]:e.controls.direction.controls[t]}loadExpenses(){this.requestFlag=!0,this.httpService.getExpenses().subscribe({next:e=>this.expenses=e,error:e=>this.errorResponse=e,complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.updateExpensesInView()}})}updateExpensesInView(){this.formGroup.controls.expenses.clear();for(let e of this.expenses)this.createExpense(e.source,e.dest,e.amount,e.due_day,e.percent,e.description,e.id)}createExpense(e,t,n,c,Z,ee,te){let ne=new v({id:new l(te),direction:new v({source:new l(E(e)),dest:new l(E(t))},W),amount:new l(n),due_day:new l(c),percent:new l(Z),descr:new l(ee,$.required)});this.formGroup.controls.expenses.push(ne)}onAdd(){this.createExpense("From","To",null,null,null,"")}onSave(){let e=[];for(let t of this.formGroup.controls.expenses.controls)e.push({id:t.controls.id?.value,source:y(this.options,t.controls.direction.controls.source.value),dest:y(this.options,t.controls.direction.controls.dest.value),due_day:t.controls.due_day?.value?t.controls.due_day.value:null,amount:t.controls.amount?.value?t.controls.amount.value:null,percent:t.controls.percent?.value?t.controls.percent.value:null,description:t.controls.descr?.value});this.requestFlag=!0,this.httpService.updateExpenses(e).subscribe({next:t=>{this.expenses=t},error:t=>this.errorResponse=t,complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.updateExpensesInView()}})}onDelete(e){let t=this.expensesArray.controls[e],n=this.getControl(t,"id").value;n?(this.requestFlag=!0,this.httpService.deleteExpense(n).subscribe({error:c=>this.errorResponse=c,complete:()=>{this.errorResponse=void 0,this.loadExpenses()}})):this.expensesArray.removeAt(e)}static \u0275fac=function(t){return new(t||o)(F(M))};static \u0275cmp=S({type:o,selectors:[["app-expenses"]],standalone:!0,features:[k],decls:18,vars:9,consts:[[1,"container"],[1,"is-flex","is-justify-content-center","m-3"],[1,"field","has-addons"],[1,"control"],[1,"button","is-danger","is-outlined","is-rounded",2,"width","100px",3,"click"],[1,"button","is-danger","is-outlined","is-rounded",2,"width","100px",3,"click","disabled"],[1,"is-flex","is-justify-content-center","m-0","min-height","is-size-7"],[1,"is-size-7","m-2","is-flex","is-justify-content-center"],[3,"formGroup"],["formArrayName","expenses"],[1,"field","has-addons",3,"id"],[3,"error"],["firstOption","From",3,"options","control"],["firstOption","To",3,"options","control"],["type","number","placeholder","Amount","min","0.5",1,"input",2,"width","100px",3,"formControl"],["type","number","placeholder","Due day","min","1","max","31",1,"input",2,"width","100px",3,"formControl"],["type","number","step","0.001","min","0","max","100","placeholder","Percentage",1,"input",2,"width","90px",3,"formControl"],["type","text","placeholder","Description","maxlength","100",1,"input",2,"min-width","90px",3,"formControl"],[1,"button","has-background-danger-60",3,"click"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"p",3)(4,"button",4),x("click",function(){return n.onAdd()}),m(5),f(6,"translate"),s()(),i(7,"p",3)(8,"button",5),x("click",function(){return n.onSave()}),m(9),f(10,"translate"),s()()()(),i(11,"div",6),C(12,ie,2,1),s(),i(13,"div",7)(14,"form",8)(15,"ng-component",9),V(16,se,16,9,"div",10,A),s()()()()),t&2&&(r(5),g(h(6,5,"Add new")),r(3),p("disabled",!n.formGroup.valid),r(),g(h(10,7,"Save All")),r(3),_(n.requestFlag?12:-1),r(2),p("formGroup",n.formGroup),r(2),G(n.expensesArray.controls))},dependencies:[U,O,N,z,j,B,K,J,X,L,P,H,Y,I,D,q]})}return o})();export{ve as ExpensesComponent};
