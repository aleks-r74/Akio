import{a as z,b as Y}from"./chunk-LAP3NJCA.js";import{h as I}from"./chunk-YE6UFMUY.js";import{Ha as m,Ja as v,Ka as P,La as V,Ma as u,Na as F,Pa as w,Pb as $,Qa as E,Ra as a,Sa as l,Ta as q,W as T,Wa as D,Xa as f,Ya as c,a as B,b as R,bc as M,cc as O,da as U,dc as A,ea as y,ec as N,fa as x,fb as p,gb as g,hb as b,kb as k,ma as j,nb as L,ob as S,pb as _,ua as o,va as C}from"./chunk-EFT7P6D7.js";var W=(i,d,e)=>({"is-grey is-dark":i,"is-light":d,"is-link is-hoverable":e});function X(i,d){if(i&1){let e=D();a(0,"span",6),f("click",function(){y(e);let n=c().$implicit,s=c();return x(s.onEmployeeClick(n))}),p(1),l()}if(i&2){let e=c().$implicit,t=c();v("ngClass",L(2,W,t.readOnly,!e.scheduled,!t.readOnly)),o(),b(" ",e.name," ")}}function Z(i,d){if(i&1&&(a(0,"span",7),p(1),l()),i&2){let e=c().$implicit;P("is-link",e.scheduled),o(),b(" ",e.name," ")}}function ee(i,d){if(i&1&&m(0,X,2,6,"span",4)(1,Z,2,3,"span",5),i&2){let e=c();u(e.authService.getAccessLevel()>1?0:1)}}var H=(()=>{class i{authService;scheduleDisplay;updatedSchedule=new j;readOnly;day;month;imageStyle=`background-image: url(${Y.assetPath}/assets/images/calendar-background.jpg);`;constructor(e){this.authService=e}ngOnChanges(e){this.day=this.scheduleDisplay.date.slice(-2);let[t,n,s]=this.scheduleDisplay.date.split("-").map(Number),r=new Date(t,n-1,s),h=new Date,G=new Date(h.getFullYear(),h.getUTCMonth(),h.getUTCDate());this.month=r.toLocaleString("default",{month:"long"}),this.readOnly=r<G}onEmployeeClick(e){this.readOnly||(e=R(B({},e),{scheduled:!e.scheduled}),this.scheduleDisplay.employees.filter(t=>t.name===e.name).map(t=>t.scheduled=!t.scheduled),this.updatedSchedule.emit(this.scheduleDisplay))}static \u0275fac=function(t){return new(t||i)(C(I))};static \u0275cmp=T({type:i,selectors:[["app-calendar-box"]],inputs:{scheduleDisplay:"scheduleDisplay"},outputs:{updatedSchedule:"scheduleUpdate"},standalone:!0,features:[U,k],decls:9,vars:8,consts:[[1,"cell","is-flex","is-justify-content-center"],[1,"box","m-0","p-0","has-text-centered","background"],[1,"pacifico-small","is-flex","is-justify-content-center","my-1","p-0"],[1,"pacifico-big","lifted","is-flex","is-justify-content-center","m-0","p-0"],[1,"tag","is-small","mx-1","my-0","lifted",3,"ngClass"],[1,"tag","is-small","mx-1","my-0","lifted",3,"is-link"],[1,"tag","is-small","mx-1","my-0","lifted",3,"click","ngClass"],[1,"tag","is-small","mx-1","my-0","lifted"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),p(3),S(4,"translate"),l(),a(5,"div",3),p(6),l(),w(7,ee,2,1,null,null,F),l()()),t&2&&(o(),V(n.imageStyle),P("disabled",n.readOnly),o(2),g(_(4,6,n.month)),o(3),g(n.day),o(),E(n.scheduleDisplay.employees))},dependencies:[$,O,M],styles:[".pacifico-big[_ngcontent-%COMP%]{font-family:Pacifico,cursive;font-weight:400;font-style:normal;font-size:2.5rem;color:#fff}.pacifico-small[_ngcontent-%COMP%]{font-family:Pacifico,cursive;font-weight:400;font-style:normal;font-size:1.5rem;color:#fff}.lifted[_ngcontent-%COMP%]{position:relative;top:-15px}.background[_ngcontent-%COMP%]{background-size:cover;background-position:center;opacity:.9;width:160px;height:128px}.disabled[_ngcontent-%COMP%]{filter:brightness(.5)}"]})}return i})();function te(i,d){if(i&1){let e=D();a(0,"div",1)(1,"button",7),f("click",function(){y(e);let n=c();return x(n.onSaveClick())}),p(2),S(3,"translate"),l()()}i&2&&(o(2),g(_(3,1,"Save")))}function ie(i,d){if(i&1&&q(0,"app-error",8),i&2){let e=c(2);v("error",e.errorResponse)}}function ne(i,d){i&1&&(a(0,"p"),p(1),S(2,"translate"),l()),i&2&&(o(),b("",_(2,1,"Loading"),"..."))}function se(i,d){if(i&1&&m(0,ie,1,1,"app-error",8)(1,ne,3,3,"p"),i&2){let e=c();u(e.errorResponse?0:1)}}function oe(i,d){i&1&&(a(0,"p"),p(1),S(2,"translate"),l()),i&2&&(o(),g(_(2,1,"Saved")))}function le(i,d){if(i&1){let e=D();a(0,"app-calendar-box",9),f("scheduleUpdate",function(n){y(e);let s=c();return x(s.onScheduleUpdate(n))}),l()}if(i&2){let e=d.$implicit;v("scheduleDisplay",e)}}var Ce=(()=>{class i{httpService;authService;errorResponse;requestFlag=!1;successFlag=!1;employees=[];scheduleDtos=[];originalScheduleDtos=[];displaySchedule=[];constructor(e,t){this.httpService=e,this.authService=t}ngOnInit(){this.requestFlag=!0,this.httpService.getUsers(["ROLE_EMPLOYEE"]).subscribe({next:e=>{this.employees=e},error:e=>this.errorResponse=e,complete:()=>{this.errorResponse=void 0,this.requestFlag=!1,this.loadSchedule(new Date().toISOString().substring(0,10))}})}loadSchedule(e){this.requestFlag=!0,this.httpService.getSchedule(e).subscribe({next:t=>{this.scheduleDtos=[],this.originalScheduleDtos=[],this.scheduleDtos=t,this.originalScheduleDtos=[...t]},error:t=>this.errorResponse=t,complete:()=>{this.requestFlag=!1,this.errorResponse=void 0;let t=this.scheduleDtos.map(n=>n.employees).reduce((n,s)=>(s.forEach(r=>n.push(r)),n)).filter((n,s,r)=>r.indexOf(n)===s);new Date(e).getUTCMonth()<new Date().getUTCMonth()?this.displaySchedule=this.scheduleDtoToScheduleDisplay(this.scheduleDtos,t).reverse():this.displaySchedule=this.scheduleDtoToScheduleDisplay(this.scheduleDtos,this.employees).reverse()}})}onScheduleUpdate(e){for(let t=0;t<this.scheduleDtos.length;t++)this.scheduleDtos[t].date===e.date&&(this.scheduleDtos[t]=this.scheduleDisplayToScheduleDto(e))}scheduleDtoToScheduleDisplay(e,t){let n=[];for(let s of e){let r={date:s.date,employees:[]};for(let h of t)s.employees.includes(h)?r.employees.push({name:h,scheduled:!0}):r.employees.push({name:h,scheduled:!1});n.push(r)}return n}scheduleDisplayToScheduleDto(e){let t,n=e.employees.filter(s=>s.scheduled).map(s=>s.name);return t={date:e.date,employees:n},t}onMonthSelected(e){this.successFlag=!1;let t=e+"-01";this.loadSchedule(t)}onSaveClick(){this.successFlag=!1;let e=[];for(let t=0;t<this.originalScheduleDtos.length;t++)this.originalScheduleDtos[t].employees.length>this.scheduleDtos[t].employees.length&&e.push(this.originalScheduleDtos[t]);this.requestFlag=!0,e.length>0?this.httpService.deleteSchedule(e).subscribe({error:t=>{this.errorResponse=t},complete:()=>{this.updateSchedule()}}):this.updateSchedule()}updateSchedule(){this.httpService.updateSchedule(this.scheduleDtos).subscribe({next:e=>{this.scheduleDtos=[],this.originalScheduleDtos=[],this.scheduleDtos=e,this.originalScheduleDtos=[...e]},error:e=>{this.errorResponse=e},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.displaySchedule=this.scheduleDtoToScheduleDisplay(this.scheduleDtos,this.employees).reverse(),this.successFlag=!0}})}static \u0275fac=function(t){return new(t||i)(C(N),C(I))};static \u0275cmp=T({type:i,selectors:[["app-schedule"]],standalone:!0,features:[k],decls:10,vars:3,consts:[["label","Schedule for",3,"dateMonthSelected"],[1,"is-flex","is-justify-content-center","m-3"],[1,"is-flex","is-justify-content-center","m-0","min-height","is-size-7"],[1,"container","is-max-widescreen"],[1,"fixed-grid","has-3-cols-mobile","has-4-cols-tablet","has-6-cols-desktop"],[1,"grid","is-column-gap-0"],[3,"scheduleDisplay"],[1,"button","is-danger","is-outlined","is-rounded",2,"width","150px",3,"click"],[3,"error"],[3,"scheduleUpdate","scheduleDisplay"]],template:function(t,n){t&1&&(a(0,"app-date-month",0),f("dateMonthSelected",function(r){return n.onMonthSelected(r)}),l(),m(1,te,4,3,"div",1),a(2,"div",2),m(3,se,2,1)(4,oe,3,3,"p"),l(),a(5,"div",3)(6,"div",4)(7,"div",5),w(8,le,1,1,"app-calendar-box",6,F),l()()()),t&2&&(o(),u(n.authService.getAccessLevel()>1?1:-1),o(2),u(n.requestFlag?3:-1),o(),u(n.successFlag?4:-1),o(4),E(n.displaySchedule))},dependencies:[z,H,A,O,M],styles:[".min-height[_ngcontent-%COMP%]{min-height:40px}"]})}return i})();export{Ce as ScheduleComponent};
