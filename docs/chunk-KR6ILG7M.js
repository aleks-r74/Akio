import{c as ne,d as ie,e as oe}from"./chunk-5NIFZWX5.js";import{a as _e,b as Ce,c as A}from"./chunk-YVWKGETZ.js";import{h as te}from"./chunk-EBEEJGSA.js";import{a as X}from"./chunk-YIFQWM42.js";import{b as ae,c as P,d as re,e as se,f as G,g as B,h as le,i as me,k as ce,l as pe,n as de,s as ue,t as fe,v as he}from"./chunk-IZBGVFEL.js";import{$a as $,Ha as v,Ja as f,Ka as N,Ma as C,Na as b,Pa as E,Qa as D,Ra as a,Rb as z,Sa as r,Ta as x,Tb as O,Ua as Y,Ub as W,Va as H,W as S,Wa as w,Xa as p,Ya as d,a as V,b as R,da as q,ea as g,fa as y,fb as s,fc as k,gb as _,gc as I,hb as T,hc as Z,ib as J,jc as ee,lb as F,ma as M,ob as K,pb as Q,qb as m,rb as c,sb as U,ua as o,va as L}from"./chunk-YEVMIGMU.js";function xe(n,u){if(n&1){let e=w();a(0,"div",0)(1,"div",1)(2,"form",2),p("ngSubmit",function(){g(e);let i=d();return y(i.onSubmit())}),a(3,"div",3),Y(4,4),a(5,"p",5),x(6,"app-select",6),r(),a(7,"p",5),x(8,"app-select",7),r(),H(),a(9,"p",5),x(10,"input",8),m(11,"translate"),r(),a(12,"p",5),x(13,"input",9),m(14,"translate"),r(),a(15,"p",5)(16,"button",10),s(17),m(18,"translate"),r()()()()()()}if(n&2){let e=d();o(2),f("formGroup",e.transferForm),o(4),f("control",e.sourceControl)("options",e.containerNames),o(2),f("control",e.destControl)("options",e.containerNames),o(2),$("placeholder",c(11,9,"Amount")),o(3),$("placeholder",c(14,11,"Description")),o(3),f("disabled",!e.transferForm.valid),o(),T(" ",c(18,13,"Transfer")," ")}}var ye=(()=>{class n{containerNames;moneyFlowEvent=new M;transferForm=new G({direction:new G({source:new B("From",P.required),dest:new B("To",P.required)},_e),amount:new B("",[P.required,P.min(1)]),descr:new B("",P.required)});get sourceControl(){return this.transferForm.controls.direction.controls.source}get destControl(){return this.transferForm.controls.direction.controls.dest}onSubmit(){let e=this.transferForm.controls.direction.get("source").value,t=this.transferForm.controls.direction.get("dest").value;e=A(this.containerNames,e),t=A(this.containerNames,t);let i={source:e,dest:t,amount:parseFloat(this.transferForm.controls.amount.value),description:this.transferForm.controls.descr.value};this.transferForm.controls.amount.setValue(""),this.transferForm.controls.descr.setValue(""),this.moneyFlowEvent.emit(i)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["app-transfer-form"]],inputs:{containerNames:"containerNames"},outputs:{moneyFlowEvent:"moneyFlowEvent"},standalone:!0,features:[F],decls:1,vars:1,consts:[[1,"container","is-max-tablet"],[1,"m-1","is-flex","is-justify-content-center"],[3,"ngSubmit","formGroup"],[1,"field","has-addons"],["formGroupName","direction"],[1,"control"],["firstOption","From",3,"control","options"],["firstOption","To",3,"control","options"],["type","number","min","0.5","formControlName","amount",1,"input","is-size-7-touch",3,"placeholder"],["type","text","formControlName","descr","maxlength","100",1,"input","is-size-7-touch",3,"placeholder"],["type","submit",1,"button","is-info","is-size-7-touch",3,"disabled"]],template:function(t,i){t&1&&v(0,xe,19,15,"div",0),t&2&&C(i.containerNames?0:-1)},dependencies:[he,le,ae,me,re,se,fe,ue,ce,de,pe,Ce,I,k]})}return n})();var Fe=(n,u)=>({"has-background-success-95":n,"has-background-success-75":u});function Me(n,u){if(n&1){let e=w();a(0,"button")(1,"span",2),x(2,"i",3)(3,"i",4),r(),a(4,"table",5),p("click",function(){let i=g(e).$implicit,l=d(2);return y(l.onContainerClick(i))}),a(5,"tr")(6,"td",6),s(7),r()(),a(8,"tr")(9,"td"),s(10),r()()()()}if(n&2){let e=u.$implicit,t=d(2);o(2),N("is-invisible",!t.checkInFlow(e.containerName)),o(),N("is-invisible",!t.checkOutFlow(e.containerName)),o(),f("ngClass",K(7,Fe,e!=t.selected,e==t.selected)),o(3),_(e.containerName),o(3),_(e.balance)}}function Te(n,u){if(n&1&&(a(0,"div",0)(1,"div",1),E(2,Me,11,10,"button",null,b),r()()),n&2){let e=d();o(2),D(e.containers)}}var ve=(()=>{class n{containers;summaryMfs;clickEvent=new M;templateBgColor="has-background-success-95";selectedBgColor="has-background-success-75";selected;outFlow=[];inFlow=[];ngOnChanges(e){if(!this.summaryMfs)return;let t=new Date;this.inFlow=[],this.outFlow=[];for(let i of this.summaryMfs){let l=new Date(i.time_stamp),h=l.getDate()===t.getDate()&&l.getMonth()===t.getMonth()&&l.getFullYear()===t.getFullYear();h&&this.inFlow?.push(i.dest),h&&this.outFlow?.push(i.source)}}checkInFlow(e){for(let t of this.inFlow)if(t===e)return!0;return!1}checkOutFlow(e){for(let t of this.outFlow)if(t===e)return!0;return!1}onContainerClick(e){this.selected=e,this.clickEvent.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["app-containers"]],inputs:{containers:"containers",summaryMfs:"summaryMfs"},outputs:{clickEvent:"containerClick"},standalone:!0,features:[q,F],decls:1,vars:1,consts:[[1,"is-flex","is-justify-content-center"],[1,"field","is-grouped","is-grouped-multiline","is-justify-content-center"],[1,"icon"],[1,"fa-solid","fa-angles-down","mx-1"],[1,"fa-solid","fa-angles-up","mx-1"],[1,"has-background-success-95","fixed-width-tag","has-text-centered","is-size-6",3,"click","ngClass"],[1,"is-capitalized","has-text-weight-bold"]],template:function(t,i){t&1&&v(0,Te,4,0,"div",0),t&2&&C(i.containers?0:-1)},dependencies:[z],styles:[".fixed-width-tag[_ngcontent-%COMP%]{min-width:90px;white-space:nowrap;border-radius:10px}"]})}return n})();var be=(n,u,e)=>({"has-background-info-65":n,"has-background-info-35":u,highlighted:e});function Ee(n,u){if(n&1){let e=w();a(0,"button",4),p("click",function(){let i=g(e).$implicit,l=d();return y(l.onDirectionSelected(i))}),s(1),m(2,"titlecase"),m(3,"titlecase"),r()}if(n&2){let e=u.$implicit,t=d();f("ngClass",Q(7,be,e!=t.selected,e==t.selected,t.isFreshDirection(e))),o(),J("",c(2,3,e.source)," -> ",c(3,5,e.dest),"")}}var we=(()=>{class n{directions;summaryMfs;directionSelected=new M;selected;fresh=[];ngOnChanges(e){if(e.directions&&this.directions?.length==1&&setTimeout(()=>this.onDirectionSelected(this.directions[0]),0),!e.summaryMfs||!this.summaryMfs)return;let t=new Date;for(let i of this.summaryMfs){let l=new Date(i.time_stamp);l.getDate()===t.getDate()&&l.getMonth()===t.getMonth()&&l.getFullYear()===t.getFullYear()&&this.fresh.push({source:i.source,dest:i.dest})}}onDirectionSelected(e){this.selected=e,this.directionSelected.emit(e)}isFreshDirection(e){return this.fresh.some(t=>t.source===e.source&&t.dest===e.dest)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["app-money-direction"]],inputs:{directions:"directions",summaryMfs:"summaryMfs"},outputs:{directionSelected:"directionSelected"},standalone:!0,features:[q,F],decls:5,vars:0,consts:[[1,"container","is-max-tablet","has-text-centered","mt-2"],[1,"fixed-grid","has-4-cols"],[1,"cell"],[1,"button","tag","is-hoverable","has-text-white","m-1","is-size-6","is-size-7-mobile",3,"ngClass"],[1,"button","tag","is-hoverable","has-text-white","m-1","is-size-6","is-size-7-mobile",3,"click","ngClass"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),E(3,Ee,4,11,"button",3,b),r()()()),t&2&&(o(3),D(i.directions))},dependencies:[z,O],styles:["div[_ngcontent-%COMP%]{min-height:35px}span[_ngcontent-%COMP%]{min-width:90px}.highlighted[_ngcontent-%COMP%]{border-color:#96dfbe;border-bottom-width:5px}"]})}return n})();function De(n,u){n&1&&(a(0,"th",2),s(1),m(2,"translate"),r()),n&2&&(o(),_(c(2,1,"Cancel")))}function ke(n,u){if(n&1){let e=w();a(0,"td")(1,"a",3),p("click",function(){g(e);let i=d().$implicit,l=d(2);return y(l.onCancel(i.receipt_num))}),s(2),m(3,"translate"),r()()}if(n&2){let e=d().$index;o(),N("is-hidden",e!=0),o(),T(" ",c(3,3,"Cancel"),"")}}function Ie(n,u){if(n&1&&(a(0,"tr")(1,"td"),s(2),m(3,"date"),r(),a(4,"td"),s(5),m(6,"titlecase"),r(),a(7,"td"),s(8),m(9,"titlecase"),r(),a(10,"td"),s(11),r(),v(12,ke,4,5,"td"),r()),n&2){let e=u.$implicit,t=d(2);o(2),_(U(3,5,e.time_stamp,"MMMM d, HH:mm")),o(3),_(c(6,8,e.source)),o(3),_(c(9,10,e.dest)),o(3),_(e.amount),o(),C(t.showCancel?12:-1)}}function Pe(n,u){if(n&1&&(a(0,"table",0)(1,"thead")(2,"tr")(3,"th",2),s(4),m(5,"translate"),r(),a(6,"th",2),s(7),m(8,"translate"),r(),a(9,"th",2),s(10),m(11,"translate"),r(),a(12,"th",2),s(13),m(14,"translate"),r(),v(15,De,3,3,"th",2),r()(),a(16,"tbody"),E(17,Ie,13,12,"tr",null,b),r()()),n&2){let e=d();o(4),_(c(5,5,"Last transaction")),o(3),_(c(8,7,"Source")),o(3),_(c(11,9,"Dest")),o(3),_(c(14,11,"Total")),o(2),C(e.showCancel?15:-1),o(2),D(e.summary)}}function Ne(n,u){n&1&&(a(0,"p",1),s(1),m(2,"translate"),r()),n&2&&(o(),T(" ",c(2,1,"There are no user's transactions today"),""))}var Se=(()=>{class n{summary;showCancel=!1;cancelMF=new M;onCancel(e){this.cancelMF.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["app-flow-summary"]],inputs:{summary:"summary",showCancel:"showCancel"},outputs:{cancelMF:"cancelMF"},standalone:!0,features:[F],decls:2,vars:1,consts:[[1,"table","is-size-7","has-text-centered","is-hoverable","is-striped"],[1,"box"],[1,"has-text-centered"],[1,"tag","is-danger",3,"click"]],template:function(t,i){t&1&&v(0,Pe,19,13,"table",0)(1,Ne,3,3,"p",1),t&2&&C((i.summary==null?null:i.summary.length)>0?0:1)},dependencies:[I,k,O,W]})}return n})();function Be(n,u){if(n&1&&x(0,"app-error",2),n&2){let e=d();f("error",e.errorResponse)}}function Ve(n,u){n&1&&(a(0,"p",3),s(1,"Money transferred"),r())}function Re(n,u){n&1&&(a(0,"p",3),s(1),m(2,"translate"),r()),n&2&&(o(),T("",c(2,1,"Loading"),"..."))}function qe(n,u){if(n&1){let e=w();a(0,"div",6)(1,"p",19)(2,"button",20),p("click",function(){g(e);let i=d();return y(i.showSummarizedTransactions=!0)}),s(3),m(4,"translate"),r()(),a(5,"p",19)(6,"button",20),p("click",function(){g(e);let i=d();return y(i.showLastTransactions=!0)}),s(7),m(8,"translate"),r()()()}n&2&&(o(3),_(c(4,2,"Month overview")),o(4),_(c(8,4,"My Transactions")))}function ze(n,u){if(n&1){let e=w();a(0,"button",20),p("click",function(){g(e);let i=d();return y(i.showLastTransactions=!0)}),s(1),m(2,"translate"),r()}n&2&&(o(),_(c(2,1,"My Transactions")))}var Pt=(()=>{class n{httpService;authService;containers;containerNames;summaryMfs;freshMfs;selectedConatiner;moneyFlowResponseDto;dates;totalPages;currentPage=1;transactionDetails;showDetails=!1;showLastTransactions=!1;showSummarizedTransactions=!1;moneyFlowRequest={from:void 0,to:void 0,source:void 0,dest:void 0,page:this.currentPage-1};errorResponse;requestFlag=!1;moneyTransferredFlag=!1;constructor(e,t){this.httpService=e,this.authService=t}ngOnInit(){this.requestFlag=!0,this.httpService.getContainers().subscribe({next:e=>{this.containers=e.containers,this.containerNames=this.containers.map(t=>t.containerName),this.summaryMfs=e.summarizedTransactions.reverse(),this.freshMfs=e.lastTransactions.reverse()},error:e=>{this.errorResponse=e},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}})}onMoneyTransfer(e){this.requestFlag=!0,this.moneyTransferredFlag=!1,this.httpService.transferMoney(e).subscribe({next:t=>{this.containers=t},error:t=>{this.errorResponse=t},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.moneyTransferredFlag=!0,this.ngOnInit()}})}onDatesSelected(e){this.moneyFlowRequest=R(V({},this.moneyFlowRequest),{from:e.from,to:e.to,page:this.currentPage-1}),this.loadMoneyFlows()}onContainerClick(e){this.selectedConatiner=e}onPageSelected(e){this.moneyFlowRequest=R(V({},this.moneyFlowRequest),{page:e-1}),this.currentPage=e,this.loadMoneyFlows()}onDirectionSelected(e){this.currentPage=1,this.moneyFlowRequest=R(V({},this.moneyFlowRequest),{source:e.source,dest:e.dest,page:this.currentPage-1}),this.loadMoneyFlows()}loadMoneyFlows(){Object.values(this.moneyFlowRequest).some(e=>e==null)||(this.moneyTransferredFlag=!1,this.requestFlag=!0,this.httpService.getMoneyFlows(this.moneyFlowRequest).subscribe({next:e=>{this.moneyFlowResponseDto=e,this.totalPages=e.totalPages},error:e=>{this.errorResponse=e},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}}))}loadTransactionByTimestamp(e){this.requestFlag=!0,this.moneyTransferredFlag=!1,this.httpService.getTransactions({from:e,to:e},0).subscribe({next:t=>{this.transactionDetails=t.transactionsOnThePage[0],this.showDetails=!0},error:t=>{this.errorResponse=t},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}})}onCancelMF(e){this.showLastTransactions=!1,this.requestFlag=!0,this.httpService.cancelMoneyFlow(e).subscribe({error:t=>this.errorResponse=t,complete:()=>{this.ngOnInit()}})}static \u0275fac=function(t){return new(t||n)(L(ee),L(te))};static \u0275cmp=S({type:n,selectors:[["app-money-management"]],standalone:!0,features:[F],decls:21,vars:18,consts:[[1,"container","is-max-tablet"],[1,"is-flex","is-justify-content-center","mt-1",2,"min-height","35px"],[3,"error"],[1,"is-size-7"],[3,"moneyFlowEvent","containerNames"],[1,"field","is-grouped","is-grouped-multiline","is-justify-content-center"],[1,"field","has-addons"],[1,"button","is-size-7-touch","is-size-6","tag","mt-2"],[3,"containerClick","containers","summaryMfs"],[3,"directionSelected","directions","summaryMfs"],[3,"dates"],[1,"container"],[1,"columns","is-centered"],[1,"column","is-flex","is-justify-content-center","p-0","m-0"],[3,"receiptSelected","pageSelected","data","showDetails"],[3,"close","active","transaction"],[3,"close","active"],[3,"summary"],[3,"cancelMF","summary","showCancel"],[1,"control"],[1,"button","is-size-7-touch","is-size-6","tag","mt-2",3,"click"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1),v(2,Be,1,1,"app-error",2)(3,Ve,2,0,"p",3)(4,Re,3,3,"p",3),r(),a(5,"app-transfer-form",4),p("moneyFlowEvent",function(h){return i.onMoneyTransfer(h)}),r(),a(6,"div",5),v(7,qe,9,6,"div",6)(8,ze,3,3,"button",7),r(),a(9,"app-containers",8),p("containerClick",function(h){return i.onContainerClick(h)}),r(),a(10,"app-money-direction",9),p("directionSelected",function(h){return i.onDirectionSelected(h)}),r(),a(11,"app-date-between",10),p("dates",function(h){return i.onDatesSelected(h)}),r(),a(12,"div",11)(13,"div",12)(14,"div",13)(15,"app-money-flow-table",14),p("receiptSelected",function(h){return i.loadTransactionByTimestamp(h)})("pageSelected",function(h){return i.onPageSelected(h)}),r()()()(),a(16,"app-transaction-details",15),p("close",function(){return i.showDetails=!1}),r(),a(17,"app-modal",16),p("close",function(){return i.showSummarizedTransactions=!1}),x(18,"app-flow-summary",17),r(),a(19,"app-modal",16),p("close",function(){return i.showLastTransactions=!1}),a(20,"app-flow-summary",18),p("cancelMF",function(h){return i.onCancelMF(h)}),r()()()),t&2&&(o(2),C(i.errorResponse?2:-1),o(),C(i.moneyTransferredFlag&&!i.requestFlag?3:-1),o(),C(i.requestFlag&&!i.errorResponse?4:-1),o(),f("containerNames",i.containerNames),o(2),C(i.authService.getAccessLevel()>1?7:8),o(2),f("containers",i.containers)("summaryMfs",i.summaryMfs),o(),f("directions",i.selectedConatiner==null?null:i.selectedConatiner.directions)("summaryMfs",i.summaryMfs),o(5),f("data",i.moneyFlowResponseDto)("showDetails",!0),o(),f("active",i.showDetails)("transaction",i.transactionDetails),o(),f("active",i.showSummarizedTransactions),o(),f("summary",i.summaryMfs),o(),f("active",i.showLastTransactions),o(),f("summary",i.freshMfs)("showCancel",!0))},dependencies:[ye,ve,oe,ne,Z,we,ie,I,k,Se,X]})}return n})();export{Pt as MoneyManagementComponent};
