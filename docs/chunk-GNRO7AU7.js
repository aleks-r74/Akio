import{c as Z,d as ee,e as te,f as ne}from"./chunk-2DG3WP5B.js";import{a as fe,b as _e,c as z}from"./chunk-FCYK4M3J.js";import{h as X}from"./chunk-YE6UFMUY.js";import{a as Q}from"./chunk-ZZGPOI5M.js";import{b as ie,c as D,d as oe,e as re,f as G,g as k,h as ae,i as se,k as le,l as ce,n as me,s as pe,t as de,v as ue}from"./chunk-O5MWHH46.js";import{Ha as x,Ja as l,Ma as g,Na as T,Pa as E,Pb as R,Qa as b,Qb as q,Ra as o,Rb as K,Sa as a,Ta as C,Ua as A,Va as $,W as y,Wa as S,Xa as p,Ya as m,a as P,b as N,bc as B,cc as O,da as V,dc as U,ea as v,ec as W,fa as w,fb as s,gb as u,hb as H,ib as J,kb as F,ma as M,mb as I,ob as f,pb as _,qb as Y,ua as r,va as L}from"./chunk-EFT7P6D7.js";function ve(n,c){if(n&1){let e=S();o(0,"div",0)(1,"form",1),p("ngSubmit",function(){v(e);let i=m();return w(i.onSubmit())}),o(2,"div",2),A(3,3),o(4,"p",4),C(5,"app-select",5),a(),o(6,"p",4),C(7,"app-select",6),a(),$(),o(8,"p",4),C(9,"input",7),a(),o(10,"p",4),C(11,"input",8),a(),o(12,"p",4)(13,"button",9),s(14," Transfer "),a()()()()()}if(n&2){let e=m();r(),l("formGroup",e.transferForm),r(4),l("control",e.sourceControl)("options",e.containerNames),r(2),l("control",e.destControl)("options",e.containerNames),r(6),l("disabled",!e.transferForm.valid)}}var he=(()=>{class n{containerNames;moneyFlowEvent=new M;transferForm=new G({direction:new G({source:new k("From",D.required),dest:new k("To",D.required)},fe),amount:new k("",[D.required,D.min(1)]),descr:new k("",D.required)});get sourceControl(){return this.transferForm.controls.direction.controls.source}get destControl(){return this.transferForm.controls.direction.controls.dest}onSubmit(){let e=this.transferForm.controls.direction.get("source").value,t=this.transferForm.controls.direction.get("dest").value;e=z(this.containerNames,e),t=z(this.containerNames,t);let i={source:e,dest:t,amount:parseFloat(this.transferForm.controls.amount.value),description:this.transferForm.controls.descr.value};this.transferForm.controls.amount.setValue(""),this.transferForm.controls.descr.setValue(""),this.moneyFlowEvent.emit(i)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=y({type:n,selectors:[["app-transfer-form"]],inputs:{containerNames:"containerNames"},outputs:{moneyFlowEvent:"moneyFlowEvent"},standalone:!0,features:[F],decls:1,vars:1,consts:[[1,"container"],[1,"is-size-7","my-2","is-flex","is-justify-content-center",3,"ngSubmit","formGroup"],[1,"field","has-addons"],["formGroupName","direction"],[1,"control"],["firstOption","From",3,"control","options"],["firstOption","To",3,"control","options"],["type","number","placeholder","Amount","min","0.5","formControlName","amount",1,"input",2,"width","90px"],["type","text","placeholder","Description","formControlName","descr","maxlength","100",1,"input",2,"min-width","90px"],["type","submit",1,"button",3,"disabled"]],template:function(t,i){t&1&&x(0,ve,15,6,"div",0),t&2&&g(i.containerNames?0:-1)},dependencies:[ue,ae,ie,se,oe,re,de,pe,le,me,ce,_e]})}return n})();var we=(n,c)=>({"has-background-danger-95":n,"has-background-danger-85":c});function Fe(n,c){n&1&&C(0,"i",3)}function xe(n,c){n&1&&C(0,"i",4)}function Se(n,c){if(n&1){let e=S();o(0,"button")(1,"span",2),x(2,Fe,1,0,"i",3)(3,xe,1,0,"i",4),a(),o(4,"table",5),p("click",function(){let i=v(e).$implicit,d=m(2);return w(d.onContainerClick(i))}),o(5,"tr")(6,"td",6),s(7),a()(),o(8,"tr")(9,"td"),s(10),a()()()()}if(n&2){let e=c.$implicit,t=m(2);r(2),g(t.checkInFlow(e.containerName)?2:-1),r(),g(t.checkOutFlow(e.containerName)?3:-1),r(),l("ngClass",I(5,we,e!=t.selected,e==t.selected)),r(3),u(e.containerName),r(3),u(e.balance)}}function Me(n,c){if(n&1&&(o(0,"div",0)(1,"div",1),E(2,Se,11,8,"button",null,T),a()()),n&2){let e=m();r(2),b(e.containers)}}var ge=(()=>{class n{containers;summaryMfs;clickEvent=new M;templateBgColor="has-background-danger-95";selectedBgColor="has-background-danger-85";selected;outFlow=[];inFlow=[];ngOnChanges(e){if(!this.summaryMfs)return;let t=new Date;this.inFlow=[],this.outFlow=[];for(let i of this.summaryMfs){let d=new Date(i.time_stamp),h=d.getDate()===t.getDate()&&d.getMonth()===t.getMonth()&&d.getFullYear()===t.getFullYear();h&&this.inFlow?.push(i.dest),h&&this.outFlow?.push(i.source)}}checkInFlow(e){for(let t of this.inFlow)if(t===e)return!0;return!1}checkOutFlow(e){for(let t of this.outFlow)if(t===e)return!0;return!1}onContainerClick(e){this.selected=e,this.clickEvent.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=y({type:n,selectors:[["app-containers"]],inputs:{containers:"containers",summaryMfs:"summaryMfs"},outputs:{clickEvent:"containerClick"},standalone:!0,features:[V,F],decls:1,vars:1,consts:[[1,"is-flex","is-justify-content-center"],[1,"field","is-grouped","is-grouped-multiline","is-justify-content-center"],[1,"icon"],[1,"fa-solid","fa-angles-down","mx-1"],[1,"fa-solid","fa-angles-up","mx-1"],[1,"has-background-danger-95","fixed-width-tag","has-text-centered","is-size-7",3,"click","ngClass"],[1,"is-capitalized","has-text-weight-bold"]],template:function(t,i){t&1&&x(0,Me,4,0,"div",0),t&2&&g(i.containers?0:-1)},dependencies:[R],styles:[".fixed-width-tag[_ngcontent-%COMP%]{min-width:90px;white-space:nowrap;border-radius:10px}"]})}return n})();var Te=(n,c)=>({"has-background-info-65":n,"has-background-info-35":c});function Ee(n,c){if(n&1){let e=S();o(0,"span",2),p("click",function(){let i=v(e).$implicit,d=m();return w(d.onDirectionSelected(i))}),s(1),f(2,"titlecase"),f(3,"titlecase"),a()}if(n&2){let e=c.$implicit,t=m();l("ngClass",I(7,Te,e!=t.selected,e==t.selected)),r(),J("",_(2,3,e.source)," -> ",_(3,5,e.dest),"")}}var Ce=(()=>{class n{directions;directionSelected=new M;selected;ngOnChanges(e){e.directions&&this.directions?.length==1&&setTimeout(()=>this.onDirectionSelected(this.directions[0]),0)}onDirectionSelected(e){this.selected=e,this.directionSelected.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=y({type:n,selectors:[["app-money-direction"]],inputs:{directions:"directions"},outputs:{directionSelected:"directionSelected"},standalone:!0,features:[V,F],decls:3,vars:0,consts:[[1,"is-flex","is-justify-content-center","mt-1"],[1,"tag","is-hoverable","has-text-white","m-1",3,"ngClass"],[1,"tag","is-hoverable","has-text-white","m-1",3,"click","ngClass"]],template:function(t,i){t&1&&(o(0,"div",0),E(1,Ee,4,10,"span",1,T),a()),t&2&&(r(),b(i.directions))},dependencies:[R,q],styles:["div[_ngcontent-%COMP%]{min-height:35px}span[_ngcontent-%COMP%]{min-width:90px}"]})}return n})();function De(n,c){if(n&1&&(o(0,"tr")(1,"td"),s(2),f(3,"date"),a(),o(4,"td"),s(5),f(6,"titlecase"),a(),o(7,"td"),s(8),f(9,"titlecase"),a(),o(10,"td"),s(11),a()()),n&2){let e=c.$implicit;r(2),u(Y(3,4,e.time_stamp,"MMMM d, HH:mm")),r(3),u(_(6,7,e.source)),r(3),u(_(9,9,e.dest)),r(3),u(e.amount)}}var ye=(()=>{class n{summary;static \u0275fac=function(t){return new(t||n)};static \u0275cmp=y({type:n,selectors:[["app-flow-summary"]],inputs:{summary:"summary"},standalone:!0,features:[F],decls:18,vars:12,consts:[[1,"table","is-size-7","has-text-centered"],[1,"sticky-header"],[1,"has-text-centered","min-width"]],template:function(t,i){t&1&&(o(0,"table",0)(1,"thead",1)(2,"tr")(3,"th",2),s(4),f(5,"translate"),a(),o(6,"th",2),s(7),f(8,"translate"),a(),o(9,"th",2),s(10),f(11,"translate"),a(),o(12,"th",2),s(13),f(14,"translate"),a()()(),o(15,"tbody"),E(16,De,12,11,"tr",null,T),a()()),t&2&&(r(4),u(_(5,4,"Last transaction")),r(3),u(_(8,6,"Source")),r(3),u(_(11,8,"Dest")),r(3),u(_(14,10,"Total")),r(3),b(i.summary))},dependencies:[O,B,q,K]})}return n})();function ke(n,c){if(n&1&&C(0,"app-error",1),n&2){let e=m();l("error",e.errorResponse)}}function Pe(n,c){n&1&&(o(0,"p",2),s(1,"Money transferred"),a())}function Ne(n,c){n&1&&(o(0,"p",2),s(1),f(2,"translate"),a()),n&2&&(r(),H("",_(2,1,"Loading"),"..."))}function Ve(n,c){if(n&1){let e=S();o(0,"div",15)(1,"div",16)(2,"button",17),p("click",function(){v(e);let i=m();return w(i.showLastTransactions=!0)}),s(3),f(4,"translate"),a()()(),o(5,"app-modal",18),p("close",function(){v(e);let i=m();return w(i.showLastTransactions=!1)}),C(6,"app-flow-summary",19),a()}if(n&2){let e=m();r(3),u(_(4,3,"Month overview")),r(2),l("active",e.showLastTransactions),r(),l("summary",e.summaryMfs)}}function Ie(n,c){if(n&1){let e=S();o(0,"app-pagination",20),p("pageSelected",function(i){v(e);let d=m();return w(d.onPageSelected(i))}),a()}if(n&2){let e=m();l("currentPage",e.currentPage)("totalPages",e.totalPages)}}var wt=(()=>{class n{httpService;authService;containers;containerNames;summaryMfs;selectedConatiner;moneyFlowResponseDto;dates;totalPages;currentPage=1;transactionDetails;showDetails=!1;showLastTransactions=!1;moneyFlowRequest={from:void 0,to:void 0,source:void 0,dest:void 0,page:this.currentPage-1};errorResponse;requestFlag=!1;moneyTransferredFlag=!1;constructor(e,t){this.httpService=e,this.authService=t}ngOnInit(){this.requestFlag=!0,this.httpService.getContainers().subscribe({next:e=>{this.containers=e.containers,this.containerNames=this.containers.map(t=>t.containerName),this.summaryMfs=e.lastTransactions.reverse()},error:e=>{this.errorResponse=e},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}})}onMoneyTransfer(e){this.requestFlag=!0,this.moneyTransferredFlag=!1,this.httpService.transferMoney(e).subscribe({next:t=>{this.containers=t},error:t=>{this.errorResponse=t},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0,this.moneyTransferredFlag=!0,this.ngOnInit()}})}onDatesSelected(e){this.moneyFlowRequest=N(P({},this.moneyFlowRequest),{from:e.from,to:e.to,page:this.currentPage-1}),this.loadMoneyFlows()}onContainerClick(e){this.selectedConatiner=e}onPageSelected(e){this.moneyFlowRequest=N(P({},this.moneyFlowRequest),{page:e-1}),this.currentPage=e,this.loadMoneyFlows()}onDirectionSelected(e){this.currentPage=1,this.moneyFlowRequest=N(P({},this.moneyFlowRequest),{source:e.source,dest:e.dest,page:this.currentPage-1}),this.loadMoneyFlows()}loadMoneyFlows(){Object.values(this.moneyFlowRequest).some(e=>e==null)||(this.moneyTransferredFlag=!1,this.requestFlag=!0,this.httpService.getMoneyFlows(this.moneyFlowRequest).subscribe({next:e=>{this.moneyFlowResponseDto=e,this.totalPages=e.totalPages},error:e=>{this.errorResponse=e},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}}))}loadTransactionByTimestamp(e){this.requestFlag=!0,this.moneyTransferredFlag=!1,this.httpService.getTransactions({from:e,to:e},0).subscribe({next:t=>{this.transactionDetails=t.transactionsOnThePage[0],this.showDetails=!0},error:t=>{this.errorResponse=t},complete:()=>{this.requestFlag=!1,this.errorResponse=void 0}})}static \u0275fac=function(t){return new(t||n)(L(W),L(X))};static \u0275cmp=y({type:n,selectors:[["app-money-management"]],standalone:!0,features:[F],decls:18,vars:13,consts:[[1,"is-flex","is-justify-content-center","mt-1",2,"min-height","35px"],[3,"error"],[1,"is-size-7"],[3,"moneyFlowEvent","containerNames"],[3,"containerClick","containers","summaryMfs"],[3,"directionSelected","directions"],[3,"dates"],[1,"container","my-3"],[1,"columns","is-centered"],[1,"column","is-four-fifths-tablet","is-two-thirds-desktop","is-flex","is-justify-content-end"],[3,"currentPage","totalPages"],[1,"container"],[1,"column","is-flex","is-justify-content-center","p-0","m-0"],[3,"receiptSelected","data","showDetails"],[3,"close","active","transaction"],[1,"is-flex","is-justify-content-center","m-3"],[1,"field","is-grouped","is-grouped-multiline","is-justify-content-center"],[1,"button","tag",3,"click"],[3,"close","active"],[3,"summary"],[3,"pageSelected","currentPage","totalPages"]],template:function(t,i){t&1&&(o(0,"div",0),x(1,ke,1,1,"app-error",1)(2,Pe,2,0,"p",2)(3,Ne,3,3,"p",2),a(),o(4,"app-transfer-form",3),p("moneyFlowEvent",function(h){return i.onMoneyTransfer(h)}),a(),x(5,Ve,7,5),o(6,"app-containers",4),p("containerClick",function(h){return i.onContainerClick(h)}),a(),o(7,"app-money-direction",5),p("directionSelected",function(h){return i.onDirectionSelected(h)}),a(),o(8,"app-date-between",6),p("dates",function(h){return i.onDatesSelected(h)}),a(),o(9,"div",7)(10,"div",8)(11,"div",9),x(12,Ie,1,2,"app-pagination",10),a()()(),o(13,"div",11)(14,"div",8)(15,"div",12)(16,"app-money-flow-table",13),p("receiptSelected",function(h){return i.loadTransactionByTimestamp(h)}),a()()()(),o(17,"app-transaction-details",14),p("close",function(){return i.showDetails=!1}),a()),t&2&&(r(),g(i.errorResponse?1:-1),r(),g(i.moneyTransferredFlag&&!i.requestFlag?2:-1),r(),g(i.requestFlag&&!i.errorResponse?3:-1),r(),l("containerNames",i.containerNames),r(),g(i.authService.getAccessLevel()>1?5:-1),r(),l("containers",i.containers)("summaryMfs",i.summaryMfs),r(),l("directions",i.selectedConatiner==null?null:i.selectedConatiner.directions),r(5),g(i.totalPages&&i.totalPages>1?12:-1),r(4),l("data",i.moneyFlowResponseDto)("showDetails",!0),r(),l("active",i.showDetails)("transaction",i.transactionDetails))},dependencies:[he,ge,ne,te,Z,U,Ce,ee,O,B,ye,Q]})}return n})();export{wt as MoneyManagementComponent};
