import{a as N,b as J,d as G,e as K}from"./chunk-5NIFZWX5.js";import{h as F}from"./chunk-EBEEJGSA.js";import"./chunk-YIFQWM42.js";import{Ca as L,Ha as f,Ja as g,Ka as S,Ma as v,Na as I,Pa as D,Qa as M,Ra as a,Sa as o,Ta as O,Ub as z,W as T,Wa as x,Xa as _,Ya as p,a as B,b as $,da as j,ea as h,fa as C,fb as l,fc as P,gb as c,gc as E,hb as w,hc as A,ib as V,jb as U,jc as H,lb as b,ma as y,qb as m,rb as u,sb as q,ua as s,va as R}from"./chunk-YEVMIGMU.js";function ee(n,d){if(n&1){let e=x();a(0,"app-pagination",11),_("pageSelected",function(t){h(e);let r=p();return C(r.onPageNumClick(t))}),o()}if(n&2){let e=p();g("currentPage",e.currentPage)("totalPages",e.totalPages)}}function te(n,d){if(n&1){let e=x();a(0,"button",18),_("click",function(){let t=h(e).$implicit,r=p(2).$implicit,k=p();return C(k.onEmployeeSelected(r,t))}),l(1),o()}if(n&2){let e=d.$implicit,i=p(2).$implicit;S("is-info",i.employee===e),s(),c(e)}}function ne(n,d){if(n&1&&D(0,te,2,3,"button",17,I),n&2){let e=p(2);M(e.employeeList)}}function ie(n,d){if(n&1&&(a(0,"button",16),l(1),m(2,"translate"),o()),n&2){let e=p().$implicit;s(),w(" ",e.employee?e.employee:u(2,1,"Not assigned")," ")}}function ae(n,d){if(n&1){let e=x();a(0,"tr")(1,"td",12),l(2),m(3,"date"),o(),a(4,"td",12),l(5),o(),a(6,"td",12),l(7),o(),a(8,"td",13),_("click",function(){let t=h(e).$implicit,r=p();return C(r.onTransactionClick(t))}),a(9,"div"),l(10),m(11,"transactionServicesPipe"),o()(),a(12,"td",14)(13,"div",15),f(14,ne,2,0)(15,ie,3,3,"button",16),o()()()}if(n&2){let e=d.$implicit,i=p();s(2),c(q(3,5,e.date_time,"MMM dd HH:mm")),s(3),c(e.receipt_num),s(2),c(e.money_accepted),s(3),c(u(11,8,e.services)),s(4),v((e.employee===""||!e.readonly)&&i.authService.getAccessLevel()>1?14:15)}}var X=(()=>{class n{authService;transactionUpd=new y;pageSelected=new y;httpResponse;employeeList;screenSize=screen.width;totalPages;currentPage;transactionDetails;showDetails=!1;constructor(e){this.authService=e}ngOnChanges(e){e.httpResponse&&(this.totalPages=this.httpResponse?.totalPages,this.currentPage=this.httpResponse?.currentPage,this.currentPage=this.currentPage?this.currentPage+1:1)}onPageNumClick(e){this.pageSelected.emit(e)}onTransactionClick(e){this.transactionDetails=e,this.showDetails=!0}onEmployeeSelected(e,i){e.employee=i,this.transactionUpd.emit()}static \u0275fac=function(i){return new(i||n)(R(F))};static \u0275cmp=T({type:n,selectors:[["app-transactions-table"]],inputs:{httpResponse:"httpResponse",employeeList:"employeeList"},outputs:{transactionUpd:"transactionUpd",pageSelected:"pageSelected"},standalone:!0,features:[j,b],decls:39,vars:27,consts:[[1,"container","is-max-tablet"],[1,"is-flex","is-justify-content-center"],[1,"table","is-hoverable","is-striped","is-narrow-mobile","has-text-centered","is-size-7-mobile","is-size-6","my-2","mx-0","px-0","is-fullwidth"],["colspan","5",1,"m-0","p-0"],[1,"is-flex","is-justify-content-center","mb-1"],[3,"currentPage","totalPages"],[1,"has-background-danger-95"],[1,"has-text-centered"],[1,"has-background-info-95"],[1,"has-text-centered","has-text-weight-bold"],[3,"close","active","transaction"],[3,"pageSelected","currentPage","totalPages"],[1,"has-text-centered","is-vcentered"],[1,"has-text-left",3,"click"],[1,"p-1","is-vcentered"],[1,"tags","is-centered"],[1,"tag","is-info"],[1,"tag","is-hoverable",3,"is-info"],[1,"tag","is-hoverable",3,"click"]],template:function(i,t){i&1&&(a(0,"div",0)(1,"div",1)(2,"table",2)(3,"thead")(4,"tr")(5,"td",3)(6,"div",4),f(7,ee,1,2,"app-pagination",5),o()()(),a(8,"tr",6)(9,"th",7),l(10),m(11,"translate"),o(),a(12,"th",7),l(13),m(14,"translate"),o(),a(15,"th",7),l(16),m(17,"translate"),o(),a(18,"th",7),l(19),m(20,"translate"),o(),a(21,"th",7),l(22),m(23,"translate"),o()()(),a(24,"tbody"),D(25,ae,16,10,"tr",null,I),o(),a(27,"tfoot")(28,"tr",8),O(29,"td"),a(30,"td",9),l(31),o(),a(32,"td",9),l(33),o(),a(34,"td",9),l(35),m(36,"translate"),o(),O(37,"td"),o()()()()(),a(38,"app-transaction-details",10),_("close",function(){return t.showDetails=!1}),o()),i&2&&(s(7),v(t.currentPage&&t.totalPages?7:-1),s(3),c(u(11,15,"Time")),s(3),c(u(14,17,"Receipt")),s(3),c(u(17,19,"Paid")),s(3),c(u(20,21,"Services")),s(3),c(u(23,23,"Employee")),s(3),M(t.httpResponse==null?null:t.httpResponse.transactionsOnThePage),s(6),V("",t.httpResponse==null||t.httpResponse.transactionsOnThePage==null?null:t.httpResponse.transactionsOnThePage.length,"/",t.httpResponse==null?null:t.httpResponse.count,""),s(2),V("",t.httpResponse==null?null:t.httpResponse.pageSum,"/",t.httpResponse==null?null:t.httpResponse.sum,""),s(2),U("",u(36,25,"Page")," ",(t.httpResponse==null?null:t.httpResponse.currentPage)+1," / ",t.httpResponse==null?null:t.httpResponse.totalPages,""),s(3),g("active",t.showDetails)("transaction",t.transactionDetails))},dependencies:[N,G,J,z,E,P],styles:[".date-time[_ngcontent-%COMP%]{min-width:90px}.services[_ngcontent-%COMP%]{min-width:250px}.employee[_ngcontent-%COMP%]{min-width:100px}"]})}return n})();function oe(n,d){if(n&1&&(a(0,"span",6)(1,"span",7),l(2),o(),a(3,"span",8),l(4),o()()),n&2){let e=d.$implicit,i=d.$index,t=p();S("mt-responsive",i!==0&&t.screenSize>500),s(2),w("",e.name,":"),s(2),c(e.sum)}}var Y=(()=>{class n{employeeCalcs;saveClick=new y;resetClick=new y;screenSize=screen.width;onSaveClick(){this.saveClick.emit()}onResetClick(){this.resetClick.emit()}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=T({type:n,selectors:[["app-employee-total"]],inputs:{employeeCalcs:"employeeCalcs"},outputs:{saveClick:"saveClick",resetClick:"resetClick"},standalone:!0,features:[b],decls:12,vars:6,consts:[[1,"is-flex-touch","is-justify-content-center","is-align-items-center"],[1,"tags","has-addons","is-centered","m-0","pb-1","fixed-width-tag",3,"mt-responsive"],[1,"container","is-flex-touch","is-justify-content-center","is-align-items-center"],[1,"mb-1","mx-1"],[1,"button","tag","is-hoverable","is-danger",2,"width","100%",3,"click"],[1,"button","tag","is-hoverable","is-primary",2,"width","100%",3,"click"],[1,"tags","has-addons","is-centered","m-0","pb-1","fixed-width-tag"],[1,"tag","is-info",2,"width","50%"],[1,"tag","is-light","has-text-weight-semibold",2,"width","50%"]],template:function(i,t){i&1&&(a(0,"div",0),D(1,oe,5,4,"span",1,I),o(),a(3,"div",2)(4,"div",3)(5,"button",4),_("click",function(){return t.onResetClick()}),l(6),m(7,"translate"),o()(),a(8,"div",3)(9,"button",5),_("click",function(){return t.onSaveClick()}),l(10),m(11,"translate"),o()()()),i&2&&(s(),M(t.employeeCalcs),s(5),c(u(7,2,"Reset")),s(4),c(u(11,4,"Save")))},dependencies:[E,P],styles:[".fixed-width-tag[_ngcontent-%COMP%]{min-width:100px;white-space:nowrap}.pagination-height[_ngcontent-%COMP%]{height:42px}@media (min-width: 1024px){.mt-responsive[_ngcontent-%COMP%]{margin-top:1rem}}@media (max-width: 1023px){.mt-responsive[_ngcontent-%COMP%]{margin-top:0}}"]})}return n})();function se(n,d){n&1&&(a(0,"p"),l(1),m(2,"translate"),o()),n&2&&(s(),w("",u(2,1,"Loading")," ..."))}function re(n,d){if(n&1&&O(0,"app-error",1),n&2){let e=p();g("error",e.errors())}}function le(n,d){if(n&1){let e=x();a(0,"div",7)(1,"app-employee-total",8),_("saveClick",function(){h(e);let t=p(2);return C(t.saveTransactions())})("resetClick",function(){h(e);let t=p(2);return C(t.onResetClick())}),o()()}if(n&2){let e=p(2);s(),g("employeeCalcs",e.emloyeeCalcs)}}function pe(n,d){if(n&1){let e=x();a(0,"div",5)(1,"app-transactions-table",6),_("transactionUpd",function(){h(e);let t=p();return C(t.onEmployeeSet())})("pageSelected",function(t){h(e);let r=p();return C(r.onPageSelected(t))}),o()(),f(2,le,2,1,"div",7)}if(n&2){let e=p();s(),g("httpResponse",e.response)("employeeList",e.employees),s(),v(e.authService.getAccessLevel()>1?2:-1)}}function ce(n,d){n&1&&(a(0,"div",0)(1,"p"),l(2,"No data for this period"),o()())}var $e=(()=>{class n{httpService;authService;fromDateTime;toDateTime;employees;emloyeeCalcs;savedCalcs;response;dates;errors=L(void 0);requestFlag=!1;constructor(e,i){this.httpService=e,this.authService=i;let t=new Date,r=new Date;t.setUTCHours(0),t.setMinutes(0),t.setSeconds(0),r.setUTCHours(23),r.setMinutes(59),r.setSeconds(0),this.toDateTime=r.toISOString().substring(0,19),this.fromDateTime=t.toISOString().substring(0,19)}calculateEmployeeTransactions(){if(!this.employees)return;let e=[];for(let i of this.employees){let t=this.response?.transactionsOnThePage.filter(r=>r.employee===i&&!r.readonly).map(r=>r.money_accepted).reduce((r,k)=>r+k,0);t=t||0,this.savedCalcs?.has(i)&&(t+=this.savedCalcs?.get(i)),e.push({name:i,sum:t})}this.emloyeeCalcs=e}onEmployeeSet(){this.calculateEmployeeTransactions()}onResetClick(){this.response?.transactionsOnThePage.forEach(e=>{e.readonly||(e.employee="")}),this.calculateEmployeeTransactions()}onDatesSelected(e){this.dates=e,this.loadData(1)}onPageSelected(e){this.loadData(e)}loadData(e){this.requestFlag=!0,this.httpService.getTransactions(this.dates,e-1).subscribe({next:i=>{this.response=$(B({},i),{transactionsOnThePage:i.transactionsOnThePage.map(t=>(t.employee&&(t.readonly=!0),t))}),this.savedCalcs=new Map(Object.entries(i.employeesSum)),this.employees=Array.from(this.savedCalcs.keys())},error:i=>this.errors.set(i),complete:()=>{this.requestFlag=!1,this.onResetClick()}})}saveTransactions(){this.requestFlag=!0,this.response&&this.httpService.updateTransactionsEmployees(this.response.transactionsOnThePage).subscribe({error:e=>{this.errors.set(e)},complete:()=>{this.loadData(this.response.currentPage+1)}})}static \u0275fac=function(i){return new(i||n)(R(H),R(F))};static \u0275cmp=T({type:n,selectors:[["app-transactions"]],standalone:!0,features:[b],decls:9,vars:4,consts:[[1,"is-flex","is-justify-content-center","mt-1"],[3,"error"],[1,"container","is-max-tablet"],[3,"dates"],[1,"columns","is-desktop","is-centered"],[1,"column","is-narrow","is-offset-1-desktop"],[3,"transactionUpd","pageSelected","httpResponse","employeeList"],[1,"column","is-narrow"],[3,"saveClick","resetClick","employeeCalcs"]],template:function(i,t){i&1&&(a(0,"div",0),f(1,se,3,3,"p")(2,re,1,1,"app-error",1),o(),a(3,"div",2)(4,"app-date-between",3),_("dates",function(k){return t.onDatesSelected(k)}),o()(),a(5,"div",2)(6,"div",4),f(7,pe,3,3)(8,ce,3,0,"div",0),o()()),i&2&&(S("is-invisible",!t.requestFlag),s(),v(t.errors()?2:1),s(6),v(t.response!=null&&t.response.count&&(t.response!=null&&t.response.count)?7:8))},dependencies:[X,Y,K,A,E,P]})}return n})();export{$e as TransactionsComponent};
